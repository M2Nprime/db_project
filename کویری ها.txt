-- Query 1: Find movies released after 2010, ordered by score.
SELECT 
    Title, 
    ReleaseYear, 
    TMDbScore
FROM 
    Movie
WHERE 
    ReleaseYear > 2010
ORDER BY 
    TMDbScore DESC;
-- Query 2: Find all movies belonging to the 'Action' genre using JOINs.
SELECT
    m.Title,
    m.ReleaseYear,
    g.GenreName
FROM
    Movie AS m
JOIN
    Movie_Genre AS mg ON m.MovieID = mg.MovieID
JOIN
    Genre AS g ON mg.GenreID = g.GenreID
WHERE
    g.GenreName = 'Action';
    -- Query 3: Find the top 10 actors with the most movies.
SELECT
    p.FullName,
    COUNT(ma.MovieID) AS MovieCount
FROM
    Person AS p
JOIN
    Movie_Actor AS ma ON p.PersonID = ma.PersonID
GROUP BY
    p.PersonID, p.FullName
ORDER BY
    MovieCount DESC
LIMIT 10;
-- Query 4: Average score per genre, for genres with more than 5 movies.
SELECT
    g.GenreName,
    COUNT(m.MovieID) AS NumberOfMovies,
    AVG(m.TMDbScore) AS AverageScore
FROM
    Genre AS g
JOIN
    Movie_Genre AS mg ON g.GenreID = mg.GenreID
JOIN
    Movie AS m ON mg.MovieID = m.MovieID
WHERE
    m.TMDbScore IS NOT NULL -- Ignore movies with no score
GROUP BY
    g.GenreName
HAVING
    NumberOfMovies > 5
ORDER BY
    AverageScore DESC;
    
-- Query 5: Find the movie(s) with the highest score using a subquery.
SELECT
    Title,
    TMDbScore
FROM
    Movie
WHERE
    TMDbScore = (SELECT MAX(TMDbScore) FROM Movie);
    
-- Query 6: Find the debut year for actors with more than one movie.
SELECT
    p.FullName,
    COUNT(m.MovieID) AS MovieCount,
    MIN(m.ReleaseYear) AS DebutYear
FROM
    Person AS p
JOIN
    Movie_Actor AS ma ON p.PersonID = ma.PersonID
JOIN
    Movie AS m ON ma.MovieID = m.MovieID
WHERE
    m.ReleaseYear IS NOT NULL
GROUP BY
    p.PersonID, p.FullName
HAVING
    MovieCount > 1
ORDER BY
    DebutYear ASC;

-- Query 7: Find above-average movies made after the year 2000.
SELECT
    Title,
    TMDbScore,
    ReleaseYear
FROM
    Movie
WHERE
    TMDbScore > (SELECT AVG(TMDbScore) FROM Movie WHERE TMDbScore IS NOT NULL)
    AND ReleaseYear > 2000
ORDER BY
    TMDbScore DESC;
    
-- Query 8: Find movies starring both 'Tom Hanks' and 'Tim Allen'.
SELECT
    m.Title,
    m.ReleaseYear
FROM
    Movie AS m
JOIN
    Movie_Actor AS ma ON m.MovieID = ma.MovieID
JOIN
    Person AS p ON ma.PersonID = p.PersonID
WHERE
    p.FullName IN ('Tom Hanks', 'Tim Allen')
GROUP BY
    m.MovieID, m.Title, m.ReleaseYear
HAVING
    COUNT(p.PersonID) = 2;
    
-- Query 9: Find American movies post-2010 with a runtime under 110 minutes.
SELECT
    Title,
    ReleaseYear,
    DurationInMinutes,
    Country
FROM
    Movie
WHERE
    Country = 'United States of America'
    AND ReleaseYear > 2010
    AND DurationInMinutes < 110
    AND DurationInMinutes IS NOT NULL -- Ensure we only get movies with a known duration
ORDER BY
    TMDbScore DESC;

    
-- Query 10 (Corrected): Find movies by a specific director made in a specific country.
SELECT
    m.Title,
    p.FullName AS Director,
    m.TMDbScore,
    m.Country AS MovieCountry
FROM
    Movie AS m
JOIN
    Person AS p ON m.DirectorID = p.PersonID
WHERE
    p.FullName = 'Christopher Nolan'
    AND m.Country LIKE '%United States of America%'
ORDER BY
    m.TMDbScore DESC;